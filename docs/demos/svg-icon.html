<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>SVG图标组件示例</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .icon-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        border: 1px solid #eee;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="icon-box">
      <svg-icon href="/logo.svg" style="color: #4caf50; font-size: 2em"></svg-icon>
      <svg-icon href="/logo.svg" style="color: #4caf50; font-size: 2em"></svg-icon>
      <svg-icon href="/logo.svg" style="color: #4caf50; font-size: 2em"></svg-icon>
    </div>

    <script>
      class SvgIcon extends HTMLElement {
        static cache = new Map()

        constructor() {
          super()
          this.attachShadow({ mode: 'open' })
          this.shadowRoot.innerHTML = `
          <style>
            :host { display: inline-block; width: 1em; height: 1em; }
            svg { width: 100%; height: 100%; fill: currentColor; }
          </style>
          <div id="icon"></div>
        `
        }

        connectedCallback() {
          this.loadIcon()
        }

        async loadIcon() {
          const href = this.getAttribute('href')
          if (!href) return

          const [url, id] = href.split('#')

          try {
            let svg = SvgIcon.cache.get(url) || (await (await fetch(url)).text())
            if (!SvgIcon.cache.has(url)) SvgIcon.cache.set(url, svg)

            if (id) {
              const doc = new DOMParser().parseFromString(svg, 'image/svg+xml')
              const symbol = doc.getElementById(id)
              if (symbol) {
                this.shadowRoot.getElementById('icon').innerHTML = `
                <svg viewBox="${symbol.getAttribute('viewBox')}">
                  <use href="#${id}"></use>
                </svg>
              `
                return
              }
            }
            this.shadowRoot.getElementById('icon').innerHTML = svg
          } catch (e) {
            console.error('SVG加载失败:', e)
          }
        }
      }

      customElements.define('svg-icon', SvgIcon)
    </script>
  </body>
</html>
